<Window x:Class="AI.DiffAssistant.GUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AI.DiffAssistant.GUI"
        xmlns:conv="clr-namespace:AI.DiffAssistant.GUI.Converters"
        mc:Ignorable="d"
        Title="AI æ–‡æ¡£å·®å¼‚åŠ©æ‰‹ - é…ç½®ä¸­å¿ƒ"
        Height="600" Width="680"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource BackgroundBrush}">
    <Window.Effect>
        <DropShadowEffect BlurRadius="16" Opacity="0.3" ShadowDepth="4"/>
    </Window.Effect>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0"
                Background="{DynamicResource SurfaceBrush}"
                Padding="16,12"
                BorderThickness="0,0,0,1"
                BorderBrush="{DynamicResource SeparatorBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="AI æ–‡æ¡£å·®å¼‚åŠ©æ‰‹ - é…ç½®ä¸­å¿ƒ"
                           FontSize="15"
                           FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                <Button Grid.Column="1"
                        Content="â˜€/â˜¾"
                        Width="48"
                        Height="32"
                        Command="{Binding ToggleThemeCommand}"
                        ToolTip="åˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜"
                        Padding="0"
                        FontSize="16"
                        Cursor="Hand"/>
            </Grid>
        </Border>

        <!-- ä¸»å†…å®¹åŒº -->
        <Border Grid.Row="1" Background="{DynamicResource BackgroundBrush}">
            <TabControl Margin="12"
                        Background="{DynamicResource BackgroundBrush}"
                        BorderThickness="0"
                        Padding="0">
                <!-- Tab 1: AI æœåŠ¡è®¾ç½® -->
                <TabItem Header="AI æœåŠ¡">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Base URL -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Base URL:"/>
                            <TextBox Grid.Column="1"
                                     Text="{Binding BaseUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="AI API çš„åŸºç¡€åœ°å€"/>
                        </Grid>

                        <!-- API Key -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="API Key:"/>
                            <PasswordBox Grid.Column="1"
                                         Name="PasswordBox"
                                         Padding="8,4"
                                         Height="32"
                                         ToolTip="API å¯†é’¥"
                                         PasswordChanged="PasswordBox_PasswordChanged"
                                         local:PasswordHelper.Password="{Binding ApiKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button Grid.Column="2"
                                    Content="ðŸ‘"
                                    Width="40"
                                    Margin="8,0,0,0"
                                    Padding="0"
                                    FontSize="14"
                                    Click="TogglePasswordVisibility_Click"
                                    ToolTip="æ˜¾ç¤º/éšè—å¯†é’¥"/>
                        </Grid>

                        <!-- Model Name -->
                        <Grid Grid.Row="2" Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Model:"/>
                            <TextBox Grid.Column="1"
                                     Text="{Binding ModelName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     ToolTip="è¦ä½¿ç”¨çš„æ¨¡åž‹åç§°ï¼Œå¦‚ gpt-4o"/>
                        </Grid>

                        <!-- åˆ†éš”çº¿ -->
                        <Separator Grid.Row="3" Margin="0,8" VerticalAlignment="Center"/>

                        <!-- æç¤ºè¯è®¾ç½®æ ‡é¢˜ -->
                        <TextBlock Grid.Row="4"
                                   Text="æç¤ºè¯è®¾ç½® (System Prompt)"
                                   FontWeight="Bold"
                                   FontSize="13"
                                   Margin="0,0,0,10"/>

                        <!-- System Prompt -->
                        <TextBox Grid.Row="5"
                                 Text="{Binding SystemPrompt, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Height="100"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 AcceptsReturn="True"
                                 ToolTip="ç³»ç»Ÿæç¤ºè¯ï¼ŒæŽ§åˆ¶ AI çš„è¡Œä¸ºå’Œè¾“å‡ºæ ¼å¼"/>

                        <!-- åˆ†éš”çº¿ -->
                        <Separator Grid.Row="6" Margin="0,16,0,16" VerticalAlignment="Center"/>

                        <!-- æŒ‰é’®åŒºåŸŸ -->
                        <StackPanel Grid.Row="7" Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Content="æµ‹è¯•è¿žæŽ¥"
                                    Command="{Binding TestConnectionCommand}"
                                    IsEnabled="{Binding IsNotTesting}"
                                    Margin="0,0,12,0"/>
                            <Button Content="ä¿å­˜é…ç½®"
                                    Command="{Binding SaveConfigCommand}"
                                    IsEnabled="{Binding IsNotSaving}"
                                    Margin="12,0,0,0"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- Tab 2: ç³»ç»Ÿé›†æˆ -->
                <TabItem Header="ç³»ç»Ÿé›†æˆ">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- æ³¨å†ŒçŠ¶æ€æ ‡é¢˜ -->
                        <TextBlock Grid.Row="0"
                                   Text="å³é”®èœå•æ³¨å†Œ"
                                   FontWeight="Bold"
                                   FontSize="13"
                                   Margin="0,0,0,16"/>

                        <!-- æ³¨å†ŒçŠ¶æ€ -->
                        <Grid Grid.Row="1" Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="å½“å‰çŠ¶æ€:"/>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding IsRegistered, Converter={conv:BoolToStatusConverter}}"
                                       Foreground="{Binding IsRegistered, Converter={conv:BoolToColorConverter}}"
                                       FontWeight="Bold"/>
                        </Grid>

                        <!-- æ³¨å†ŒæŒ‰é’®åŒºåŸŸ -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
                            <Button Content="æ·»åŠ åˆ°å³é”®èœå•"
                                    Command="{Binding RegisterCommand}"
                                    IsEnabled="{Binding NotRegistered}"
                                    Margin="0,0,12,0"/>
                            <Button Content="ä»Žå³é”®ç§»é™¤"
                                    Command="{Binding UnregisterCommand}"
                                    IsEnabled="{Binding IsRegistered}"
                                    Margin="12,0,0,0"/>
                        </StackPanel>

                        <!-- åˆ†éš”çº¿ -->
                        <Separator Grid.Row="3" Margin="0,0,0,16" VerticalAlignment="Center"/>

                        <!-- æç¤ºä¿¡æ¯ -->
                        <TextBlock Grid.Row="4"
                                   Text="æç¤º: æŒ‰ä½ Ctrl é€‰ä¸­ä¸¤ä¸ªæ–‡ä»¶ï¼Œå³é”®é€‰æ‹©ã€ŒAI å·®å¼‚åˆ†æžã€å³å¯ä½¿ç”¨"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"
                                   TextWrapping="Wrap"/>
                    </Grid>
                </TabItem>

                <!-- Tab 3: æ—¥å¿—è®¾ç½® -->
                <TabItem Header="æ—¥å¿—è®¾ç½®">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- æ—¥å¿—å¯ç”¨ -->
                        <CheckBox Grid.Row="0"
                                  Content="å¯ç”¨æ—¥å¿—"
                                  IsChecked="{Binding LoggingEnabled, Mode=TwoWay}"
                                  Margin="0,0,0,16"/>

                        <!-- æ—¥å¿—æ–‡ä»¶è·¯å¾„ -->
                        <Grid Grid.Row="1" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="æ—¥å¿—è·¯å¾„:"/>
                            <TextBox Grid.Column="1"
                                     Text="{Binding LogPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     IsEnabled="{Binding LoggingEnabled}"
                                     ToolTip="æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œæ”¯æŒ %TEMP% ç­‰çŽ¯å¢ƒå˜é‡"/>
                            <Button Grid.Column="2"
                                    Content="æµè§ˆ..."
                                    Command="{Binding BrowseLogPathCommand}"
                                    IsEnabled="{Binding LoggingEnabled}"
                                    Margin="8,0,0,0"/>
                        </Grid>

                        <!-- æ—¥å¿—çº§åˆ« -->
                        <TextBlock Grid.Row="2"
                                   Text="æ—¥å¿—çº§åˆ«:"
                                   Margin="0,0,0,8"/>
                        <StackPanel Grid.Row="3" Margin="0,0,0,20">
                            <CheckBox Content="Error - é”™è¯¯"
                                      IsChecked="{Binding LogErrorEnabled, Mode=TwoWay}"
                                      IsEnabled="{Binding LoggingEnabled}"/>
                            <CheckBox Content="Warning - è­¦å‘Š"
                                      IsChecked="{Binding LogWarningEnabled, Mode=TwoWay}"
                                      IsEnabled="{Binding LoggingEnabled}"/>
                        </StackPanel>

                        <!-- åˆ†éš”çº¿ -->
                        <Separator Grid.Row="4" Margin="0,0,0,16" VerticalAlignment="Center"/>

                        <!-- æ—¥å¿—æ“ä½œæŒ‰é’® -->
                        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,16">
                            <Button Content="æ‰“å¼€æ—¥å¿—æ–‡ä»¶"
                                    Command="{Binding OpenLogFileCommand}"
                                    Margin="0,0,12,0"/>
                            <Button Content="æ¸…é™¤æ—¥å¿—"
                                    Command="{Binding ClearLogFileCommand}"
                                    Margin="12,0,0,0"/>
                        </StackPanel>

                        <!-- ä¿å­˜æç¤º -->
                        <TextBlock Grid.Row="6"
                                   Text="æ³¨æ„: æ—¥å¿—é…ç½®éšä¸»é…ç½®ä¸€èµ·ä¿å­˜"
                                   FontSize="11"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"/>
                    </Grid>
                </TabItem>
            </TabControl>
        </Border>
    </Grid>
</Window>

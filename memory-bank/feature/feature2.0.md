## 系统托盘与后台常驻 (System Tray)

价值: 软件后台运行，随时待命，同时不占用任务栏空间。
业务规则:
启动行为: 软件启动后，在右下角系统托盘区显示一个小图标。
交互行为:
双击图标: 显示/隐藏 配置界面。
右键菜单: 提供 [主面板]、[关于]、[退出] 选项。只有点击“退出”才是真正销毁进程。
悬浮鼠标：显示 "diff-check"

## 优化方案

1. 明确托盘常驻的目标行为与边界（启动后托盘可见、任务栏不驻留、仅“退出”销毁进程）。
   - 验证：启动程序后任务栏无主窗口，托盘区有图标且进程仍在运行。

2. 准备并指定托盘图标资源（与品牌一致的 `.ico`），并确认图标在高/低 DPI 下显示正常。
   - 验证：在 100% 与 150% 缩放下查看托盘图标清晰度无明显锯齿或拉伸。

3. 实现托盘图标的启动注册与释放逻辑，确保应用退出时图标清理干净。
   - 验证：点击“退出”后托盘图标立即消失，任务管理器中进程结束。

4. 绑定托盘双击行为为“显示/隐藏配置界面”，并保持窗口状态一致（最小化/隐藏不退出）。
   - 验证：双击托盘图标能在“显示”和“隐藏”之间切换，且配置数据不丢失。

5. 绑定托盘右键菜单项（主面板/关于/退出），确保菜单项行为正确。
   - 验证：右键菜单点击“主面板”可显示窗口，“关于”弹出版本信息，“退出”彻底结束进程。

6. 设置托盘提示文本为 “diff-check”，并在运行中保持一致。
   - 验证：鼠标悬浮托盘图标，显示提示为 “diff-check”。

7. 增加异常兜底与日志记录（如托盘初始化失败或资源缺失），确保应用仍可运行。
   - 验证：人为移除托盘资源后启动，程序不崩溃且记录可定位日志。

8. 补充回归测试：托盘功能与现有右键菜单分析流程互不影响。
   - 验证：启用托盘后，右键“diff-check”分析仍可正常完成并弹出通知。

## 优化方案（澄清版）

1. 采用 WPF 原生 `NotifyIcon` 方案，并确认需要引入的 WinForms 依赖清单。
   - 验证：构建通过且不引入额外第三方库。

2. 增加托盘模式开关为“可选”，并定义默认行为（首次启动显示主界面，关闭时最小化到托盘）。
   - 验证：切换开关后行为符合预期；关闭窗口不退出，进程仍在。

3. 托盘图标复用 `diff-check.ico`，确保托盘提示文本为 “diff-check”。
   - 验证：托盘图标显示为品牌图标，悬浮提示为 “diff-check”。

4. 托盘双击行为：显示/隐藏主界面；关闭按钮行为：最小化到托盘。
   - 验证：双击可切换显示/隐藏；点击关闭只隐藏不退出。

5. 托盘右键菜单固定为“主面板/关于/退出”，并定义每项动作。
   - 验证：主面板显示窗口；关于弹窗内容齐全；退出彻底结束进程。

6. 关于弹窗内容固定为：版本号、作者、官网、版权、更新渠道。
   - 验证：打开“关于”弹窗，五项信息全部显示且无空值。

7. 托盘初始化/异常记录日志（沿用现有日志规范与路径）。
   - 验证：模拟图标资源缺失时日志中有明确错误记录，应用仍可运行。

8. 多实例交互：第二次启动仅激活已有主窗口，不创建新实例。
   - 验证：重复启动程序，主窗口被激活/置前且仅保留一个进程实例。
